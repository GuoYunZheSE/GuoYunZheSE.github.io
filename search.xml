<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2020/hello-world/</url>
    <content><![CDATA[<p>Welcome to <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvLw==">Hexo<i class="fa fa-external-link-alt"></i></span>! This is your very first post. Check <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv">documentation<i class="fa fa-external-link-alt"></i></span> for more info. If you get any problems when using Hexo, you can find the answer in <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=">troubleshooting<i class="fa fa-external-link-alt"></i></span> or you can ask me on <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==">GitHub<i class="fa fa-external-link-alt"></i></span>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s">Writing<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=">Server<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s">Generating<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s">Deployment<i class="fa fa-external-link-alt"></i></span></p>
]]></content>
  </entry>
  <entry>
    <title>Django自定义多用户类</title>
    <url>/2020/Django%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%9A%E7%94%A8%E6%88%B7%E7%B1%BB%E6%97%A0%E6%B3%95%E4%BA%A7%E7%94%9F%E7%94%A8%E6%88%B7%E8%A1%A8/</url>
    <content><![CDATA[<p>最近接了一个项目，打算用<code>Django+Vue</code>的方式去搭建一个网站.</p>
<p>由于网站的使用用户分为两类，因此决定使用<code>OneToOneField</code>的方法去自定义用户类.</p>
<p>具体代码如下:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># File: /core/modles.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user_type <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    user_mobile <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">LegalPersonTable</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    User <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span><span class="token string">'core.User'</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    company_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    unified_social_credit_code <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
    legal_person_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    legal_person_mobile <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    legal_person_certification_type <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    legal_person_certification_number <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    corresponding_person_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    corresponding_person_mobile <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    legal_person_idcard_front_url <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    legal_person_idcard_back_url <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    business_license_url <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        db_table <span class="token operator">=</span> <span class="token string">'legal_person_table'</span>

<span class="token keyword">class</span> <span class="token class-name">NaturalPersonTable</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    User <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span><span class="token string">'core.User'</span><span class="token punctuation">,</span> models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    real_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    idcard_number <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
    idcard_front_url <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    idcard_back_url <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        db_table <span class="token operator">=</span> <span class="token string">'natural_person_table'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在这里需要注意的是，如果发现运行正常，但是数据库没有改动的话：</p>
<blockquote>
<p><strong>Meta 的 managed属性</strong></p>
<p>由于Django会自动根据模型类生成映射的数据库表，如果你不希望Django这么做，可以把managed的值设置为False。</p>
<p>默认值为True,这个选项为True时Django可以对数据库表进行 migrate或migrations、删除等操作。在这个时间Django将管理数据库中表的生命周期</p>
<p>如果为False的时候，不会对数据库表进行创建、删除等操作。可以用于现有表、数据库视图等，其他操作是一样的。</p>
</blockquote>
<ol>
<li>在<code>setting.py</code>中增加<code>AUTH_USER_MODEL = &#39;core.User&#39;</code></li>
<li>需要在<code>admin.py</code>中进行注册：</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>User<span class="token punctuation">,</span> UserAdmin<span class="token punctuation">)</span>
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>NaturalPersonTable<span class="token punctuation">)</span>
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>LegalPersonTable<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>一步一步执行：</p>
<ol>
<li><p><code>python manage.py makemigrations core </code>显示正常</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">Migrations for &#39;core&#39;:
  core&#x2F;migrations&#x2F;0001_initial.py
    - Create model User
    - Create model LegalPersonTable
    - Create model NaturalPersonTable
(Spider) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>python manage.py sqlmigrate core 0001</code>同样显示正常</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">--
-- Create model User
--
CREATE TABLE &#96;core_user&#96; (&#96;id&#96; integer AUTO_INCREMENT NOT NULL PRIMARY KEY, &#96;password&#96; varchar(128) NOT NULL, &#96;last_login&#96; datetime(6) NULL, &#96;is_superuser&#96; bool NOT NULL, &#96;username&#96; varchar(150) NOT NULL UNIQUE, &#96;first_name&#96; varchar(150) NOT NULL, &#96;last_name&#96; varchar(150) NOT NULL, &#96;email&#96; varchar(254) NOT NULL, &#96;is_staff&#96; bool NOT NULL, &#96;is_active&#96; bool NOT NULL, &#96;date_joined&#96; datetime(6) NOT NULL, &#96;user_type&#96; integer NOT NULL, &#96;user_mobile&#96; varchar(20) NOT NULL);
CREATE TABLE &#96;core_user_groups&#96; (&#96;id&#96; integer AUTO_INCREMENT NOT NULL PRIMARY KEY, &#96;user_id&#96; integer NOT NULL, &#96;group_id&#96; integer NOT NULL);
CREATE TABLE &#96;core_user_user_permissions&#96; (&#96;id&#96; integer AUTO_INCREMENT NOT NULL PRIMARY KEY, &#96;user_id&#96; integer NOT NULL, &#96;permission_id&#96; integer NOT NULL);
--
-- Create model LegalPersonTable
--
CREATE TABLE &#96;legal_person_table&#96; (&#96;User_id&#96; integer NOT NULL PRIMARY KEY, &#96;company_name&#96; varchar(100) NOT NULL, &#96;unified_social_credit_code&#96; varchar(18) NOT NULL, &#96;legal_person_name&#96; varchar(50) NOT NULL, &#96;legal_person_mobile&#96; varchar(20) NOT NULL, &#96;legal_person_certification_type&#96; integer NOT NULL, &#96;legal_person_certification_number&#96; varchar(255) NOT NULL, &#96;corresponding_person_name&#96; varchar(50) NOT NULL, &#96;corresponding_person_mobile&#96; varchar(20) NOT NULL, &#96;legal_person_idcard_front_url&#96; varchar(255) NOT NULL, &#96;legal_person_idcard_back_url&#96; varchar(255) NOT NULL, &#96;business_license_url&#96; varchar(255) NOT NULL);
--
-- Create model NaturalPersonTable
--
CREATE TABLE &#96;natural_person_table&#96; (&#96;User_id&#96; integer NOT NULL PRIMARY KEY, &#96;real_name&#96; varchar(100) NOT NULL, &#96;idcard_number&#96; varchar(18) NOT NULL, &#96;idcard_front_url&#96; varchar(255) NOT NULL, &#96;idcard_back_url&#96; varchar(255) NOT NULL);
ALTER TABLE &#96;core_user_groups&#96; ADD CONSTRAINT &#96;core_user_groups_user_id_group_id_c82fcad1_uniq&#96; UNIQUE (&#96;user_id&#96;, &#96;group_id&#96;);
ALTER TABLE &#96;core_user_groups&#96; ADD CONSTRAINT &#96;core_user_groups_user_id_70b4d9b8_fk_core_user_id&#96; FOREIGN KEY (&#96;user_id&#96;) REFERENCES &#96;core_user&#96; (&#96;id&#96;);
ALTER TABLE &#96;core_user_groups&#96; ADD CONSTRAINT &#96;core_user_groups_group_id_fe8c697f_fk_auth_group_id&#96; FOREIGN KEY (&#96;group_id&#96;) REFERENCES &#96;auth_group&#96; (&#96;id&#96;);
ALTER TABLE &#96;core_user_user_permissions&#96; ADD CONSTRAINT &#96;core_user_user_permissions_user_id_permission_id_73ea0daa_uniq&#96; UNIQUE (&#96;user_id&#96;, &#96;permission_id&#96;);
ALTER TABLE &#96;core_user_user_permissions&#96; ADD CONSTRAINT &#96;core_user_user_permissions_user_id_085123d3_fk_core_user_id&#96; FOREIGN KEY (&#96;user_id&#96;) REFERENCES &#96;core_user&#96; (&#96;id&#96;);
ALTER TABLE &#96;core_user_user_permissions&#96; ADD CONSTRAINT &#96;core_user_user_permi_permission_id_35ccf601_fk_auth_perm&#96; FOREIGN KEY (&#96;permission_id&#96;) REFERENCES &#96;auth_permission&#96; (&#96;id&#96;);
ALTER TABLE &#96;legal_person_table&#96; ADD CONSTRAINT &#96;legal_person_table_User_id_9bc58715_fk_core_user_id&#96; FOREIGN KEY (&#96;User_id&#96;) REFERENCES &#96;core_user&#96; (&#96;id&#96;);
ALTER TABLE &#96;natural_person_table&#96; ADD CONSTRAINT &#96;natural_person_table_User_id_72171d3a_fk_core_user_id&#96; FOREIGN KEY (&#96;User_id&#96;) REFERENCES &#96;core_user&#96; (&#96;id&#96;);
(Spider) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>python manage.py migrate </code>即可</p>
</li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
</search>
